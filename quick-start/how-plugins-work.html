
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Plugins Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
<style>
.book-summary {
  background-color:#13262f;
  border-left-color: #344047;
}

.book-summary .summary li a, .book-summary .summary li span {
	color: #FFF !important;
}

.book-header {
	color: #7e888b;
	background-color: rgb(245, 245, 245);
}

.book-body {
	background-color: #fafafa;
}

.markdown-section pre {
	line-height: 1;
	border: 1px solid #d8d6d6;
}

.page-inner h1,
.page-inner h2,
.page-inner h3,
.page-inner h4,
.page-inner h5,
.page-inner h6 {
	color: #098BCC;
	font-weight:300;
}

#book-search-input {
	color: rgb(54, 65, 73);
	background-color: #2b3a42;
}

#book-search-input input, #book-search-input input:hover, #book-search-input input:focus {
	color: #909394 !important;
}

</style>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Quick Start</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="getting-started.html">
            
                <a href="getting-started.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="how-engine-works.html">
            
                <a href="how-engine-works.html">
            
                    
                    Engine
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="how-plugins-work.html">
            
                <a href="how-plugins-work.html">
            
                    
                    Plugins
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Reference</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../api/frequently-used-cli-functions.html">
            
                <a href="../api/frequently-used-cli-functions.html">
            
                    
                    Top used API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../api/cli-functions-shared.html">
            
                <a href="../api/cli-functions-shared.html">
            
                    
                    Shared API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../api/cli-functions-host.html">
            
                <a href="../api/cli-functions-host.html">
            
                    
                    Host only API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../api/flags.html">
            
                <a href="../api/flags.html">
            
                    
                    CLI flags
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Guides</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../guides/contributing.html">
            
                <a href="../guides/contributing.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../LICENSE.html">
            
                <a href="../LICENSE.html">
            
                    
                    License
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../guides/versioning.html">
            
                <a href="../guides/versioning.html">
            
                    
                    Versioning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../guides/testing.html">
            
                <a href="../guides/testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Examples</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../examples/simple-php-server.html">
            
                <a href="../examples/simple-php-server.html">
            
                    
                    A Simple PHP Web Server
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Plugins</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="how-the-plugins-work">How the Plugins work</h1><p>Trends and technologies change fast and most likely your needs too. With this in mind, you can implement plugins using any technology or stack of technologies. <code>Plugins</code> can be solutions to handle a different set of scenarios, but more often than not, you may build them as Services, Applications, Jobs/Tasks. These <code>plugins</code> in turn have commands that allows you to manage or execute tasks of this context. As an example, your <code>plugin</code> can be a simple webserver that has commands to start and stop it.</p><h2 id="structure">Structure</h2><p>The directory structure is also very simple as you can see in the following schema :</p><pre><code class="lang-bash">plugins/example
&#x251C;&#x2500;&#x2500; bin
&#x2502;   &#x2514;&#x2500;&#x2500; cmd          <span class="hljs-comment"># location of the commands that execute the tasks</span>
&#x2502;       &#x2514;&#x2500;&#x2500; ...
&#x251C;&#x2500;&#x2500; dependencies.ini <span class="hljs-comment"># file that contains the dependencies of this plugin</span>
&#x251C;&#x2500;&#x2500; docker           <span class="hljs-comment"># optional: contains the custom environments</span>
&#x2502;   &#x2514;&#x2500;&#x2500; ...
&#x2514;&#x2500;&#x2500; version.txt      <span class="hljs-comment"># contains the version of the plugin</span></code></pre>
<h2 id="commands">Commands</h2><p>Commands are used to execute tasks either on the host or inside the container or even on both. Some commands may require that you execute some tasks on the host before actually running inside the container, for example, if you need to prepare some directory structure on the host machine that will save the result of what was done inside the container.</p><p>In order to make this simple and generic enough, we decided to adopt the approach of having a 3-step execution that you can look at it like:</p><ul><li>prepare - runs on the HOST
</li>
<li>execute - runs on the CONTAINER
</li>
<li>cleanup - runs on the HOST
</li></ul>
<p>The sequence of the execution follows the order in the previous list. The implementation intends to be very simple on the usage side but also on the architecture side. To support a command you will need to have a file inside the commands directory that must follow the name pattern :</p><pre><code class="lang-bash">&lt;name_of_<span class="hljs-built_in">command</span>&gt;[_&lt;<span class="hljs-built_in">type</span>&gt;].sh</code></pre>
<p>As an example, imagine that you want to implement the command <code>run</code> and that this command that needs a prepare, execute and cleanup steps, then you are required to have the files <code>run_pre.sh</code>, <code>run.sh</code> and <code>run_post.sh</code>.</p><p>The purpose of splitting this into different files is to sepparate the responsabilities and make it easier to maintain.</p><p><strong>Note:</strong> All of these steps are optional, altough it does not make much sense having both a prepare and cleanup steps if no container will be used, because you can achieve the same result using only the prepare step.</p><h3 id="example-run-prepare-step">Example: run (prepare step)</h3><pre><code class="lang-bash">CMD_DESCRIPTION=<span class="hljs-string">&quot;Runs a task.&quot;</span>

athena.usage 1 <span class="hljs-string">&quot;&lt;source_directory&gt;&quot;</span>

<span class="hljs-comment"># arguments are found below</span>
<span class="hljs-built_in">source</span>_directory=<span class="hljs-string">&quot;<span class="hljs-variable">$(athena.path 1)</span>&quot;</span>

<span class="hljs-comment"># clearing arguments from the stack</span>
athena.pop_args 1

<span class="hljs-comment"># do something with the $source_directory</span>
...

<span class="hljs-comment"># mounting the directory to be used inside the container</span>
athena.docker.mount_dir <span class="hljs-string">&quot;<span class="hljs-variable">$source_directory</span>&quot;</span> <span class="hljs-string">&quot;/opt/workdir&quot;</span></code></pre>
<h3 id="example-run-execute-step">Example: run (execute step)</h3><pre><code># go inside the directory
cd /opt/workdir

# do something there
...</code></pre>
<h3 id="example-run-cleanup-step">Example: run (cleanup step)</h3><pre><code class="lang-bash"><span class="hljs-comment"># do something with the $source_directory</span>
...</code></pre>
<p>Now that you know how commands work, checkout the <a href="../api/cli-functions-shared.html">Shared API</a> and <a href="../api/cli-functions-host.html">Host API</a>, to see what functions you can use inside the commands.</p><h2 id="docker">Docker</h2><p>The main purpose of Athena is to provide an abstraction of the automation environments and let you use or create your own automation logic without much hassle.</p><p>The technology chosen to implement the abstraction is <a href="../GLOSSARY.html#docker" class="glossary-term" title="Open platform for developers and sysadmins to build, ship, and run distributed applications, whether on laptops, data center VMs, or the cloud.
https://www.docker.com">Docker</a>. If <em>Images</em>, <em>Containers</em>, <em>Dockerfile</em> doesn&apos;t ring a bell, we recommend that you read a bit about it in order to have an idea on how things work, but if you already do and just want to learn more on how to build your custom containers, please have a look at the <a href="https://docs.docker.com/engine/reference/builder/" target="_blank">Reference Page</a>.</p><p>If you intend to just use existing images from <a href="../GLOSSARY.html#dockerhub" class="glossary-term" title="Build, Ship, &amp; Run. Any App, Anywhere. Dev-test pipeline automation, 100,000+ free apps, public and private registries.
https://hub.docker.com">DockerHub</a>, then no worries because Athena also has support for it.</p><p>The functions that handle <a href="../GLOSSARY.html#docker" class="glossary-term" title="Open platform for developers and sysadmins to build, ship, and run distributed applications, whether on laptops, data center VMs, or the cloud.
https://www.docker.com">docker</a> related operations are under the namespace of <code>athena.docker.</code>, read more about it on the <a href="api/cli-functions-host.md#handling-docker">Handling Docker</a> page. Functions that are directly related to plugins are under <code>athena.plugin.</code>, read more about it on the <a href="api/cli-functions-host.md#handling-plugin">Handling Plugin</a> page.</p><p><strong>Note:</strong> There are some functions in the plugin namespace that can be wrappers to other operations for simplicity of usage, for instance, they can assume the current plugin to set some options.</p><h3 id="using-containers">Using containers</h3><p>There are two types of containers that you can use:</p><ul><li><p><strong>External</strong></p><p>The container name can be a tag that is registered in <a href="../GLOSSARY.html#dockerhub" class="glossary-term" title="Build, Ship, &amp; Run. Any App, Anywhere. Dev-test pipeline automation, 100,000+ free apps, public and private registries.
https://hub.docker.com">DockerHub</a>, e.g.: <code>php:7.0-apache</code>, <code>java:7</code>, <code>debian:jessie</code>, etc.</p></li></ul>
<ul><li><p><strong>Custom</strong> (aka your own container)</p><p>These containers must be built using a Dockerfile that needs to be located inside the plugin&apos;s <code>docker</code> folder.</p><p>If the <em>Dockerfile</em> is located on the root of the <code>docker</code> directory, then this is called the <em>default container</em> and is used when you have a command that needs to run inside a container and don&apos;t explicitly say which one to use.</p><p>If you want to have multiple containers then you need to have a sub-folder inside the <a href="../GLOSSARY.html#docker" class="glossary-term" title="Open platform for developers and sysadmins to build, ship, and run distributed applications, whether on laptops, data center VMs, or the cloud.
https://www.docker.com">docker</a> folder and there will be a <em>Dockerfile</em> and also a <code>version.txt</code> file to version this container. For the <em>default container</em>, the version of the plugin is also the version of the container.</p><pre><code class="lang-bash">...
&#x251C;&#x2500;&#x2500; docker
&#x2502;   &#x251C;&#x2500;&#x2500; Dockerfile      <span class="hljs-comment"># default container</span>
&#x2502;   &#x2514;&#x2500;&#x2500; other           <span class="hljs-comment"># other container</span>
&#x2502;       &#x251C;&#x2500;&#x2500; Dockerfile
&#x2502;       &#x2514;&#x2500;&#x2500; version.txt
&#x2514;&#x2500;&#x2500; version.txt</code></pre>
</li></ul>
<p>To use a different container than the <em>default</em> container, either an external or a custom one, you must specify it on the <em>prepare step</em>, to do so you can use the following functions :</p><pre><code class="lang-bash">athena.plugin.use_container &lt;container name&gt;</code></pre>
<p>The container name can be either the tag from <a href="../GLOSSARY.html#dockerhub" class="glossary-term" title="Build, Ship, &amp; Run. Any App, Anywhere. Dev-test pipeline automation, 100,000+ free apps, public and private registries.
https://hub.docker.com">DockerHub</a> or the name of the sub-folder in the <code>docker</code> directory.</p><p><strong>Hint:</strong> There is also another function that is helpful when using external containers that should run as a daemon.</p><pre><code class="lang-bash">athena.plugin.use_external_container_as_daemon &lt;container name&gt; [instance_name]</code></pre>
<h2 id="using-configurable-images">Using configurable images</h2><p><a href="../GLOSSARY.html#docker" class="glossary-term" title="Open platform for developers and sysadmins to build, ship, and run distributed applications, whether on laptops, data center VMs, or the cloud.
https://www.docker.com">Docker</a> allows you to have configurable images by using the <code>ARG</code> instruction, read more about it <a href="https://docs.docker.com/engine/reference/builder/#/arg" target="_blank">here</a>.</p><p>Using this mechanism, Athena allows you to create multiple environments using one single Dockerfile. This can be very useful because with this you can use</p><p>In order to achieve this, you need to use the <code>ARG</code> instructions in the Dockerfile and then have a file with key-value (commonly know as ini file), and when you want to use a specific configurable container, while executing a command, you just need to use the flag :</p><pre><code class="lang-bash"> --athena-env=&lt;environment_file|name_of_environment&gt;</code></pre>
<p>The specified environment file must follow the <em>ini file</em> format and its values will be used for building the container. If a name is specified instead of a file, Athena expects for a file named <code>&lt;name_of_environment&gt;.env</code> to exist in the folder of the <em>Dockerfile</em>.</p><h3 id="example">Example</h3><pre><code class="lang-bash">$ ./athena example run /path/to/dir --athena-env=/path/to/file/production.env</code></pre>
<p>or</p><pre><code class="lang-bash">$ ./athena example run /path/to/dir --athena-env=production</code></pre>
<h2 id="building-containers">Building containers</h2><p>Because we have a well defined structure, it is easy to build containers tagging them with the specifics of the location, environment and version. When executing a command that requires a container, Athena will try to find a container with the following pattern :</p><pre><code class="lang-bash">athena-plugin-&lt;plugin_name&gt;[-&lt;custom_container&gt;][-&lt;environment&gt;]-&lt;instance_name&gt;</code></pre>
<p>The version is also used to find it (located in the <code>version.txt</code> file of the required container). If this container has not been built yet, Athena will do it for you, if it has, then it will use it for the execution of the command.</p><p><strong>Hint:</strong> Once a specific container is built, it will only rebuild if there is an update on the version or if you specify an environment that has not been built yet.</p><h3 id="example">Example</h3><pre><code class="lang-bash">athena-plugin-example-other-production-0:1.0.0</code></pre>
<h2 id="hooks">Hooks</h2><p>There is support for <em>hooks</em> in Athena. They can be used to perform any task on a given stage of a <code>plugin</code> usage. They must be located in the directory <code>bin/hooks</code> of the <code>plugin</code>.</p><h3 id="pre-and-post-plugin">Pre and Post Plugin</h3><p>These hooks are executed before and after any command is executed. To enable them you just need to add a file called <code>plugin_pre.sh</code> and/or <code>plugin_post.sh</code> in the <em>hooks</em> directory, add logic there and that&apos;s it, they&apos;re hooked.</p><h2 id="reusing-between-commands">Reusing between commands</h2><p>Sometimes you might to want to reuse functions or variables between commands. The way to do it is very simple as you can see bellow:</p><h3 id="functions">Functions</h3><ul><li><p><strong>PRE and POST commands</strong></p><p>Implement your functions in the <code>bin/lib/functions.sh</code></p></li>
<li><p><strong>Inside containers</strong></p><p>Implement them in the <code>bin/lib/functions.container.sh</code>.</p></li></ul>
<h3 id="variables">Variables</h3><ul><li><p><strong>PRE and POST commands</strong></p><p>Add them to <code>bin/variables.sh</code>.</p></li>
<li><p><strong>Inside containers</strong></p><p>Add them to <code>bin/variables.container.sh</code></p></li></ul>
<p>That&apos;s it, they are now automatically available and you can start using them.</p><h2 id="custom-logo">Custom logo</h2><p>If you would like to have your own logo when executing the commands of your <code>plugin</code>, simply add a text file <code>.logo</code> to the root of your plugin with your ascii art.</p><h2 id="default-router">Default router</h2><p>When you need to execute a command inside a container, Athena sets a default router that maps the command that you are executing to the right file.</p><p>Sometimes you might feel the need to use a particular <a href="../GLOSSARY.html#docker" class="glossary-term" title="Open platform for developers and sysadmins to build, ship, and run distributed applications, whether on laptops, data center VMs, or the cloud.
https://www.docker.com">docker</a> image that has its own router and you actually want to preserve this behaviour. If this is the case, then you need to specify in the <code>pre</code> command file the following option :</p><pre><code class="lang-bash">athena.docker.set_no_default_router 1</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="how-engine-works.html" class="navigation navigation-prev " aria-label="Previous page: Engine">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../api/frequently-used-cli-functions.html" class="navigation navigation-next " aria-label="Next page: Top used API">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Plugins","level":"1.4","depth":1,"next":{"title":"Top used API","level":"2.1","depth":1,"path":"api/frequently-used-cli-functions.md","ref":"api/frequently-used-cli-functions.md","articles":[]},"previous":{"title":"Engine","level":"1.3","depth":1,"path":"quick-start/how-engine-works.md","ref":"quick-start/how-engine-works.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["theme-default"],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"quick-start/how-plugins-work.md","mtime":"2016-09-02T17:10:12.484Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2016-09-02T17:11:26.666Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

